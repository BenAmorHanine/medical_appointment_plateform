<nav class="navbar">
  <div class="navbar-container">
    <!-- Logo -->
    <a routerLink="/" class="navbar-logo">
      <div class="logo-gradient">
        <strong>MedWin</strong>
      </div>
    </a>

    <!-- Desktop Menu -->
    @if (!isMobile) {
      <ul class="nav-menu">
        <li>
          <a routerLink="/" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }">
            Home
          </a>
        </li>
        <li>
          <a routerLink="/doctors" routerLinkActive="active">
            Doctors
          </a>
        </li>

        <!-- For non-admin users: show Contact -->
        @if (!isAdmin) {
          <li>
            <a routerLink="/contact" routerLinkActive="active">
              Contact
            </a>
          </li>
        }

        <!-- For admin: show Patients -->
        @if (isAdmin) {
          <li>
            <a routerLink="/patients" routerLinkActive="active">
              Patients
            </a>
          </li>
        }
      </ul>
    }

    <!-- Auth / User Actions -->
    <div class="auth-actions">
      @if (isAuthenticated$ | async) {

        <!-- Admin links -->
        @if (isAdmin) {
          <a routerLink="/dashboard" routerLinkActive="active" class="btn-history">
            Dashboard
          </a>
        }

        <!-- Doctor links -->
        @if (isDoctor) {
          <a routerLink="/appointments" routerLinkActive="active" class="btn-history">
            My Appointments
          </a>
          <a routerLink="/doctor/availability" routerLinkActive="active" class="btn-history">
            Availabilities
          </a>
          <a routerLink="/profile" routerLinkActive="active" class="btn-history">
            Profile
          </a>
        }

        <!-- Patient links -->
        @if (isPatient) {
          <a routerLink="/appointments" routerLinkActive="active" class="btn-history">
            My Appointments
          </a>
          <a routerLink="/profile" routerLinkActive="active" class="btn-history">
            My Profile
          </a>
        }

        <!-- Notification icon + dropdown (keeps existing behavior + adds badge/dropdown) -->
        <div class="notif-wrapper">
          <!-- Desktop bell -->
          <button class="btn-icon notification-btn" (click)="toggleNotificationsDropdown()">
            <i class="fas fa-bell"></i>

            @if (unreadCount > 0) {
              <span class="notif-badge">{{ unreadCount }}</span>
            }
          </button>

          @if (showNotifDropdown) {
            <div class="notif-dropdown">
              <div class="notif-dropdown-header">
                <strong>Notifications</strong>
                <button class="notif-link" (click)="markAllNotificationsRead()">
                  Mark all read
                </button>
              </div>

              @if (notifications.length === 0) {
                <div class="notif-empty">No notifications</div>
              } @else {
                <ul class="notif-list">
                  @for (n of notifications; track n.id) {
                    <li class="notif-item" [class.unread]="!n.read" (click)="markOneAsRead(n)">
                      <div class="notif-title">{{ n.title }}</div>
                      <div class="notif-message">{{ n.message }}</div>
                      <div class="notif-date">{{ n.createdAt | date:'short' }}</div>
                    </li>
                  }
                </ul>

                <div class="notif-footer">
                  <button class="notif-link" (click)="goToNotifications()">View all</button>
                </div>
              }
            </div>
          }
        </div>

        <button class="btn-logout" (click)="logout()">
          <i class="fas fa-sign-out-alt"></i> Logout
        </button>

      } @else {
        <a routerLink="/auth/login" class="btn-login">
          Login
        </a>
        <a routerLink="/auth/register" class="btn-signup">
          <i class="fas fa-user-plus"></i> Sign Up
        </a>
      }
    </div>

    <!-- Mobile Menu Button -->
    @if (isMobile) {
      <button class="mobile-menu-btn" (click)="toggleMobileMenu()">
        <i class="fas fa-bars"></i>
      </button>
    }
  </div>

  <!-- Mobile Menu -->
  @if (showMobileMenu) {
    <div class="mobile-menu">
      <ul>
        <li>
          <a routerLink="/" routerLinkActive="active"
             [routerLinkActiveOptions]="{ exact: true }"
             (click)="toggleMobileMenu()">
            Home
          </a>
        </li>
        <li>
          <a routerLink="/doctors" (click)="toggleMobileMenu()">
            Doctors
          </a>
        </li>

        @if (!isAdmin) {
          <li>
            <a routerLink="/contact" (click)="toggleMobileMenu()">
              Contact
            </a>
          </li>
        }

        @if (isAdmin) {
          <li>
            <a routerLink="/patients" (click)="toggleMobileMenu()">
              Patients
            </a>
          </li>
        }

        @if (isAuthenticated$ | async) {

          <!-- Mobile notifications (same target, but can also show unread badge) -->
          <li class="mobile-notif-row">
            <button class="btn-icon" (click)="goToNotifications()">
              <i class="fas fa-bell"></i> Notifications
              @if (unreadCount > 0) {
                <span class="notif-badge mobile">{{ unreadCount }}</span>
              }
            </button>
          </li>

          @if (isDoctor) {
            <li>
              <a routerLink="/appointments" (click)="toggleMobileMenu()">
                My Appointments
              </a>
            </li>
            <li>
              <a routerLink="/doctor/availability" (click)="toggleMobileMenu()">
                Availabilities
              </a>
            </li>
            <li>
              <a routerLink="/profile" (click)="toggleMobileMenu()">
                Profile
              </a>
            </li>
          }

          @if (isPatient) {
            <li>
              <a routerLink="/appointments" (click)="toggleMobileMenu()">
                My Appointments
              </a>
            </li>
            <li>
              <a routerLink="/profile" (click)="toggleMobileMenu()">
                My Profile
              </a>
            </li>
          }

          <li>
            <button class="btn-logout-mobile" (click)="logout()">
              Logout
            </button>
          </li>

        } @else {
          <li>
            <a routerLink="/auth/login" (click)="toggleMobileMenu()" class="mobile-login">
              Login
            </a>
          </li>
          <li>
            <a routerLink="/auth/register" (click)="toggleMobileMenu()" class="mobile-signup">
              Sign Up
            </a>
          </li>
        }
      </ul>
    </div>
  }
</nav>

<!-- src/app/features/dashboard/components/dashboard.component.html -->

<section class="dashboard-hero">
  <div class="container">
    <div class="hero-content">
      <h1 class="hero-title">Admin Dashboard</h1>
      <p class="hero-subtitle">
        Overview, statistics, user management and notifications
      </p>
    </div>
  </div>
</section>

<section class="dashboard-main">
  <div class="container">

    <!-- Stats cards -->
    @if (loadingStats) {
      <p class="text-muted">Loading stats...</p>
    }
    @else if (stats) {
      <div class="stats-grid">
        <div class="stat-card">
          <h3>üë• Total patients</h3>
          <p class="stat-number stat-blue">{{ stats.totalPatients }}</p>
        </div>
        <div class="stat-card">
          <h3>ü©∫ Total doctors</h3>
          <p class="stat-number stat-green">{{ stats.totalDoctors }}</p>
        </div>
        <div class="stat-card">
          <h3>üìÖ Total appointments</h3>
          <p class="stat-number stat-orange">{{ stats.totalAppointments }}</p>
        </div>
        <div class="stat-card">
          <h3>üßæ Total consultations</h3>
          <p class="stat-number stat-purple">{{ stats.totalConsultations }}</p>
        </div>
      </div>

      <!-- ‚úÖ Quick insights -->
      <div class="insights-grid">
        <div class="insight-card accent-blue">
          <div class="insight-head">
            <span class="insight-emoji">‚öñÔ∏è</span>
            <h4>Doctors / Patients</h4>
          </div>
          <div class="insight-value">{{ doctorPatientRatio }}</div>
          <div class="insight-sub">
            {{ stats.totalDoctors }} / {{ stats.totalPatients }}
          </div>
        </div>

        <div class="insight-card accent-orange">
          <div class="insight-head">
            <span class="insight-emoji">üìà</span>
            <h4>Appointments per doctor</h4>
          </div>
          <div class="insight-value">{{ apptPerDoctor }}</div>
          <div class="insight-sub">
            {{ stats.totalAppointments }} / {{ stats.totalDoctors }}
          </div>
        </div>

        <div class="insight-card accent-purple">
          <div class="insight-head">
            <span class="insight-emoji">üìä</span>
            <h4>Appointments per patient</h4>
          </div>
          <div class="insight-value">{{ apptPerPatient }}</div>
          <div class="insight-sub">
            {{ stats.totalAppointments }} / {{ stats.totalPatients }}
          </div>
        </div>

        <div class="insight-card accent-green">
          <div class="insight-head">
            <span class="insight-emoji">‚úÖ</span>
            <h4>System status</h4>
          </div>
          <div class="insight-value ok">
            <span class="dot"></span> OK
          </div>
          <div class="insight-sub">
            Stats loaded successfully
          </div>
        </div>
      </div>
    }

    <!-- Charts placeholder -->
    <!--
    <div class="charts-row">
      <div class="chart-card">
        <h3>Appointments overview</h3>
        <p class="chart-placeholder">Charts to be added here (ng2-charts / Chart.js).</p>
      </div>
    </div>
    -->

    <!-- Users management -->
    <div class="users-section">
      <h2>Users management</h2>

      @if (loadingUsers) {
        <p class="text-muted">Loading users...</p>
      }
      @else if (users && users.length) {
        <table class="users-table">
          <thead>
            <tr>
              <th>Username</th>
              <th>Email</th>
              <th>Role</th>
              <th>Created</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            @for (u of users; track u.id) {
              <tr>
                <td>{{ u.username }}</td>
                <td>{{ u.email }}</td>
                <td>
                  <select [ngModel]="u.role" (ngModelChange)="onChangeRole(u, $event)">
                    <option value="patient">patient</option>
                    <option value="doctor">doctor</option>
                    <option value="admin">admin</option>
                  </select>
                </td>
                <td>{{ u.createdAt | date:'short' }}</td>
                <td>
                  <button class="btn-secondary" (click)="onDeleteUser(u)">Delete</button>
                </td>
              </tr>
            }
          </tbody>
        </table>
      }
      @else {
        <p>No users found.</p>
      }
    </div>

    <!-- Notification center -->
    <div class="notifications-section">
      <div class="notifications-header">
        <h2>Notifications center</h2>
        <button
          class="btn-secondary"
          (click)="onMarkAllRead()"
          [disabled]="loadingNotifications || unreadCount === 0"
        >
          Mark all as read ({{ unreadCount }} unread)
        </button>
      </div>

      @if (loadingNotifications) {
        <p class="text-muted">Loading notifications...</p>
      }
      @else if (notifications && notifications.length) {
        <ul class="notifications-list">
          @for (n of notifications; track n.id) {
            <li>
              <div class="notif-title">
                {{ n.title }}
                @if (!n.read) {
                  <span style="margin-left: 10px;" class="badge bg-primary">New</span>
                }
              </div>

              <div class="notif-message">{{ n.message }}</div>
              <div class="notif-date">{{ n.createdAt | date:'short' }}</div>
            </li>
          }
        </ul>
      }
      @else {
        <p>No notifications yet.</p>
      }
    </div>

  </div>
</section>

<div class="consultations-page">
  <!-- Bandeau hero -->
  <section class="consultations-hero">
    <div class="hero-overlay">
      <div class="container">
        <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
          <h1 class="page-title">
            <span class="gradient-text">Patient</span> Consultations
          </h1>
          <button class="btn btn-back" (click)="goBack()">
            <i class="fa fa-arrow-left me-2"></i>Back to Appointments
          </button>
        </div>
      </div>
    </div>
  </section>

  <div class="container">
    <div class="row">
      <div class="col-12">
        <!-- Historique des Consultations -->
        <app-consultation-history
          [consultations]="facade.patientConsultations()"
          (openPdf)="openPdfUrl($event)"
        />

        <!-- Formulaire Nouvelle Consultation -->
        <app-consultation-form
          [form]="formService.form()"
          [loading]="facade.loading()"
          [error]="facade.error()"
          [isSubmitDisabled]="isSubmitDisabled()"
          (formSubmit)="onSubmit()"
          (formReset)="resetForm()"
        />

        <!-- Message de succès: n'afficher que si la consultation créée appartient à l'appointment courant -->
        @if (facade.currentConsultation() && facade.appointmentState()?.id === facade.currentConsultation()?.appointmentId) {
          <app-consultation-success
            [consultation]="facade.currentConsultation()"
            (openPdf)="openPdfUrl($event)"
          />
        }
      </div>
    </div>
  </div>
</div>

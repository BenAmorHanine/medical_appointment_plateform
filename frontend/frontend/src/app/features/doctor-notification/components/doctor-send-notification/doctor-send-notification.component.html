<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-lg-6 col-md-8">

      <div class="card shadow-lg border-0 rounded-4">
        <!-- HEADER -->
        <div class="card-header bg-primary text-white text-center rounded-top-4">
          <h4 class="mb-0">
            <i class="bi bi-envelope-fill me-2"></i>
            Send Notification
          </h4>
          <small>Doctor â†’ Patient</small>
        </div>

        <!-- BODY -->
        <div class="card-body p-4">
          <form #mailForm="ngForm" (ngSubmit)="submit(mailForm)">

            <!-- TYPE -->
            <div class="mb-3">
              <label class="form-label fw-semibold">Message Type</label>
              <select
                class="form-select"
                name="type"
                ngModel
                (ngModelChange)="onTypeChange($event)"
              >
                <option value="">Select message type</option>
                <option value="reminder">ğŸ”” Appointment Reminder</option>
                <option value="followup">ğŸ©º Post-consultation Follow-up</option>
                <option value="cancel">âŒ Cancellation / Reschedule</option>
              </select>
            </div>

            <!-- NAME -->
            <div class="mb-3">
              <label class="form-label fw-semibold">Patient Name</label>
              <input
                type="text"
                class="form-control"
                name="name"
                ngModel
                required
                #nameInput="ngModel"
                placeholder="Patient full name"
              />

              @if (nameInput.invalid && nameInput.touched) {
                <div class="text-danger small mt-1">
                  Patient name is required
                </div>
              }
            </div>

            <!-- EMAIL -->
            <div class="mb-3">
              <label class="form-label fw-semibold">Patient Email</label>
              <input
                type="email"
                class="form-control"
                name="recipientEmail"
                ngModel
                required
                email
                #emailInput="ngModel"
                placeholder="example@email.com"
              />

              @if (emailInput.invalid && emailInput.touched) {
                <div class="text-danger small mt-1">
                  Please enter a valid email address
                </div>
              }
            </div>

            <!-- SUBJECT -->
            <div class="mb-3">
              <label class="form-label fw-semibold">Subject</label>
              <input
                type="text"
                class="form-control"
                name="subject"
                ngModel
                required
                placeholder="Email subject"
              />
            </div>

            <!-- MESSAGE -->
            <div class="mb-4">
              <label class="form-label fw-semibold">Message</label>
              <textarea
                rows="6"
                class="form-control"
                name="message"
                [(ngModel)]="defaultMessage"
                required
                minlength="5"
                #messageInput="ngModel"
                placeholder="Write your message here..."
              ></textarea>

              @if (messageInput.invalid && messageInput.touched) {
                <div class="text-danger small mt-1">
                  Message must be at least 5 characters
                </div>
              }
            </div>

            <!-- HIDDEN ROLE -->
            <input type="hidden" name="role" ngModel value="patient" />

            <!-- BUTTON -->
            <button
              type="submit"
              class="btn btn-primary w-100 py-2 fw-semibold"
              [disabled]="mailForm.invalid || loading"
            >
              <span *ngIf="!loading">
                <i class="bi bi-send me-2"></i> Send Email
              </span>
              <span *ngIf="loading">
                <span class="spinner-border spinner-border-sm me-2"></span>
                Sending...
              </span>
            </button>

          </form>

          <!-- FEEDBACK -->
          @if (successMessage) {
            <div class="alert alert-success mt-3">
              <i class="bi bi-check-circle me-2"></i>
              {{ successMessage }}
            </div>
          }

          @if (errorMessage) {
            <div class="alert alert-danger mt-3">
              <i class="bi bi-x-circle me-2"></i>
              {{ errorMessage }}
            </div>
          }
        </div>
      </div>

    </div>
  </div>
</div>
